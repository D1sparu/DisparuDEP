(()=>{"use strict";var t={http:"80",https:"443"},e=function(){function e(e,n,i,o,s){var r=this;this.hostOrigin=n,this.permittedParentOrigin=i,this.parentWindow=o,this.iframeAttrs=s,this.destroy=function(){window.removeEventListener("message",r.handleAction)},this.handleAction=function(t){var e=t.source,n=t.data,i=t.origin;e===r.extensionFrame.contentWindow&&i===r.extensionOrigin?r.postToParent(n):e===r.parentWindow&&null!==i.match(r.permittedParentOrigin)?r.postToExtension(n):console.error("Got message from unexpected source "+i+" "+JSON.stringify(n))},this.extensionFrame=document.createElement("iframe"),this.extensionFrame.setAttribute("frameBorder","0");var a=window.document,c=document.createElement("meta");c.httpEquiv="Content-Security-Policy",this.extensionOrigin=function(e){var n=document.createElement("a");n.setAttribute("href",e);var i=n.protocol+"//"+n.hostname,o=n.protocol.slice(0,-1);return n.port&&n.port!==t[o]&&(i+=":"+n.port),i}(e),c.content="frame-src 'self' "+this.extensionOrigin,this.extensionFrame.setAttribute("style",this.iframeAttrs.style||"width: 100%; height: 100%"),this.extensionFrame.setAttribute("scrolling",this.iframeAttrs.scrolling||"yes"),this.extensionFrame.setAttribute("sandbox",this.iframeAttrs.sandbox||"allow-scripts allow-forms"),this.extensionFrame.setAttribute("allow","encrypted-media"),this.extensionFrame.style.width="100%",a.head.appendChild(c),a.body.appendChild(this.extensionFrame),this.extensionFrame.setAttribute("src",e),window.addEventListener("message",this.handleAction)}return e.init=function(t,n,i,o,s){e.instance||(e.instance=new e(t,n,i,o,s))},e.prototype.postToExtension=function(t){try{this.extensionFrame.contentWindow.postMessage(t,this.extensionOrigin)}catch(t){console.error("Caught error in incoming action: "+t.stack)}},e.prototype.postToParent=function(t){try{this.parentWindow.postMessage(t,this.hostOrigin)}catch(t){console.error("Caught error in outgoing action: "+t.stack)}},e}(),n=/^https:\/\/(?:[^\.]+\.)*?twitch\.(tv|tech)(:\d{0,5})?$/;document.addEventListener("DOMContentLoaded",(function(){window.parent.postMessage({action:"supervisor-ready"},"*"),document.body.setAttribute("tabindex","-1"),document.documentElement.setAttribute("style","height: 100%; width: 100%;")})),window.addEventListener("message",(function(t){var i=t.source,o=t.data,s=t.origin;if(i===window.parent&&null!==s.match(n)&&"supervisor-init"===o.action){var r=o.options,a=r.extensionURL,c=r.hostOrigin,h=r.iframeAttrs;e.init(a,c,n,window.parent,h)}}))})();