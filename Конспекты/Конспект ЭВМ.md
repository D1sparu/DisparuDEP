Теги: [[Учеба]]

Организация памяти в ЭВМ
ЭВМ, реализованная по классической фон-неймановской архитектуре, вклю-
чает в себя:
*  процессор, содержащий арифметико-логическое устройство (АЛУ) и центральное устройство управления (ЦУУ);
*  память, которая в современных ЭВМ подразделяется на оперативную (ОП или ОЗУ) и сверхоперативную (СОЗУ);
*  внешние устройства, к которым относят внешнюю память (ВЗУ) и устройства ввода/вывода (УВВ)

# Концепция многоуровневой памяти

Известно, что память ЭВМ предназначена для хранения  программ и данных причем эффективность работы ЭВМ во многом определяется характеристиками ее памяти. Во все времена к память предъявлялось три основных требования: *большой объем, высокое быстродействие и низкая (умеренная) стоимость*.

В основе большинства ЭВМ лежит трехуровневая организация памяти: сверхоперативная (СОЗУ) — оперативная (ОЗУ) — внешняя (ВЗУ). СОЗУ и ОЗУ могут непосредственно взаимодействовать с процессором, ВЗУ взаимодействует только с ОЗУ.

Связь между процессором и ОЗУ осуществляется по системному или специализированному
интерфейсу и требует для своего осуществления машинных циклов. Информация, находящаяся в ВЗУ, не может быть непосредственно использована процессором. Для использования программ и данных, расположенных в ВЗУ, их необходимо предварительно переписать в ОЗУ. Процесс обмена информацией между ВЗУ и ОЗУ осуществляется средствами специального канала или (реже) — непосредственно под управлением
процессора. Объем ВЗУ практически неограничен, а быстродействие на 3—6 порядков ниже
процессорного.

![[Pasted image 20240921100207.png]]

Следует помнить, что положение ЗУ в иерархии памяти ЭВМ определяется
не элементной базой запоминающих ячеек (известны случаи реализации ВЗУ
на БИС — "электронный диск" и, наоборот, организация оперативной памяти
на электромеханических ЗУ — магнитных барабанах), а возможностью доступа процессора к данным, расположенным в этом ЗУ.

При организации памяти современных ЭВМ (МПС) особое внимание уделяется сверхоперативной памяти и принципам обмена информацией между
ОЗУ и ВЗУ.

___

# Сверхоперативная память

Применение СОЗУ в иерархической памяти ЭВМ может обеспечить повышение производительности ЭВМ за счет снижения среднего времени обращения к памяти T при условии, что время цикла СОЗУ СT бу дет (значительно) меньше времени цикла ОЗУ To . Очевидно:

![[Pasted image 20240921100501.png]]

где Pc — вероятности обращения к СОЗУ. Обозначим так же: Po — веро-
ятности обращения к ОЗУ.

Из  следует, что повышение производительности ЭВМ может осуществ-
ляться двумя путями: 

![[Pasted image 20240921100944.png]]

____
# СОЗУ с прямым доступом

Глава 5. Организация памяти в ЭВМ 119
5.2.1. СОЗУ с прямым доступом
СОЗУ с прямым доступом (РОН — регистры общего назначения) получило
широкое распространение в большинстве современных ЭВМ.

Фактически РОН — это небольшая регистровая намять, доступ к которой осуществляется
специальными командами. Стратегия размещения данных в РОН целиком
определяется программистом (компилятором).
# СОЗУ с ассоциативным доступом

Применение СОЗУ с ассоциативным доступом позволяет автоматизировать
процесс размещения данных в СОЗУ, обеспечивая "подмену" активных
в данный момент ячеек ОЗУ ячейками СОЗУ.

Эффективность такого подхода
существенно зависит от выбранной стратегии замены информации в СОЗУ,
причем использование ассоциативного СОЗУ имеет смысл только при условии ![[Pasted image 20240921101143.png]] 

Принцип ассоциативного доступа состоит в следующем. Накопитель ассоциативного запоминающего устройства (АЗУ) разбит на два поля — информационное и признаков. Структура информационного поля накопителя соответствует структуре обычного ОЗУ, а запоминающий элемент поля признаков, помимо функции записи, чтения и хранения бита, обеспечивает сравнение хранимой информации с поступающей и выдачу признака равенства.

Признаки равенства всех элементов одной ячейки поля признаков объединяются по "И" и устанавливают в 1 индикатор совпадения ИС, если информация, хранимая в поле признака ячейки, совпадает с информацией, подаваемой в качестве признака на вход Р накопителя.

Во второй фазе обращения (при чтении) на выход данных D последовательно поступает содержимое информационных полей тех ячеек, индикаторы совпадения которых установлены в 1 (если таковые найдутся).

Если имеет место совпадение признака ячейки с запрашиваемым адресом (не
более одного раза, алгоритм загрузки АСОЗУ не предусматривает возможности появления одинаковых признаков), то процессор обращается (по чтению или по записи) в информационное поле этой ячейки АСОЗУ, при этом блокируется обращение к ОЗУ. Если требуемый адрес не найден в АСОЗУ, инициируется (или продолжается) обращение к ОЗУ, причем в АСОЗУ создается копия ячейки ОЗУ, к которой обратился процессор. Повторное обращение
процессора по этому адресу будет реализовано в АСОЗУ (на порядок быстрее, чем в ОЗУ).

![[Pasted image 20240921101434.png]]

При необходимости записи в АСОЗУ новой информации требуется отыскать
свободную ячейку, а при ее отсутствии (что чаще всего и бывает) — отыскать ячейку, содержимое которой можно удалить из АСОЗУ. При этом
следует помнить, что если во время пребывания ячейки в АСОЗУ в нее про-
изводилась запись, то требуется не просто очистить содержимое ячейки,
а записать его в ОЗУ по адресу, хранящемуся в поле признаков, т. к. процессор, отыскав адрес в АСОЗУ, производит запись только туда, оставляя в ОЗУ
старое значение (так называемое "АСОЗУ с обратной записью"). Возможен и
другой режим работы СОЗУ — со сквозной записью, при котором всякая запись осуществляется и СОЗУ, и в ОЗУ.

При поиске очищаемой ячейки чаще всего используют метод случайного выбора. Иногда отмечают ячейки, в которые не проводилась запись, и поиск "кандидата на удаление" проводят из них.

Более сложная процедура замещения предполагает учет длительности пребывания ячеек в АСОЗУ, или частоты обращения по этому адресу, или времени с момента последнего обращения. Однако все эти методы требуют дополнительных аппаратных и временных затрат.

Одним из наиболее дешевых способов, позволяющих учитывать поток обращений к ячейкам, является следующий. Каждой ячейке АСОЗУ ставится в соответствие бит (триггер) обращения, который устанавливается при обращении к этой ячейке. Когда биты обращения всех ячеек АСОЗУ установятся в 1, все они одновременно сбрасываются в 0. Поиск очищаемой ячейки осуществляется среди ячеек, биты обращения которых нулевые, причем если таких ячеек несколько, то среди них осуществляется случайная выборка.

Наличие АСОЗУ в ЭВМ позволяет (при достаточном его объеме и правильно
выбранной стратегии загрузки) значительно увеличить производительность
системы. При этом наличие или отсутствие АСОЗУ никак не отражается на
построении программы. АСОЗУ не является программно-доступным объектом, оно скрыто от пользователя. Недаром в литературе для обозначения
АСОЗУ часто используется термин "кэш-память" (cache — тайник).

Кэш-память, структура которой приведена на рис. 5.2, носит название полностью ассоциативной. Здесь каждая ячейка кэш может подменять любую
ячейку ОЗУ. Достоинство такой памяти — максимальная вероятность кэш-попадания (при прочих равных условиях), по сравнению с другими способами организации кэш. К недостаткам можно отнести сложность ее структуры (а следовательно, и высокую стоимость). Действительно, в каждом разряде поля признаков необходимо реализовать, наряду с возможностями записи и хранения, функцию сравнения хранимого бита с соответствующим битом признака, а потом конъюнкцию результатов сравнения разрядов в каждой ячейке.

Кэш-память с прямым отображением требует минимальных затрат оборудования (по сравнению с другими вариантами организации кэш), но имеет минимальную вероятность кэш-попаданий. Суть организации состоит в следующем. Физическая оперативная намять разбивается на блоки (множества) одинакового размера, количество которых (блоков) соответствует числу ячеек кэш, причем каждой строке ставится в соответствие определенное множество ячеек памяти, не пересекающееся с другими. Все ячейки множества претендуют на одну строку кэш.

Такая организация кэш исключает собственно ассоциативный поиск, а следовательно, значительно упрощается схема ячейки поля признаков. Действительно, здесь копия требуемой ячейки оперативной памяти может располагаться
в единственной строке кэш.

Такая организация кэш исключает собственно ассоциативный поиск, а следовательно, значительно упрощается схема ячейки поля признаков. Действительно, здесь копия требуемой ячейки оперативной памяти может располагаться в единственной строке кэш. Часть физического адреса определяет номер множества и, следовательно, строку кэш. Содержимое этой строки выбирается по обычному адресному принципу, и поле тега сравнивается с младшей частью физического адреса. Таким образом, для всей кэш-памяти (любого размера) достаточно единственной схемы сравнения.

![[Pasted image 20240921105857.png]]

Во-первых, хотя адресное пространство физической памяти 32-разрядных
микропроцессоров составляет 32
2 байтов, в современных ПЭВМ обычно используют намять объемом - 2^26 
2 байтов. Следовательно, строки кэш,
отображаемые на старшие (физически отсутствующие) множества памяти,
никогда не будут использованы.

Во-вторых, если в множества включать следующие подряд ячейки ОЗУ, то
копии никаких двух последовательных ячеек ОЗУ нельзя одновременно
иметь в кэш (кроме случая последней и первой ячеек двух соседних мно-
жеств), что противоречит одной из основополагающих стратегий загрузки
кэш — целесообразности копирования в кэш группы последовательных
ячеек ОЗУ.

___


![[Pasted image 20240921114546.png]]

Для исключения отмеченных недостатков разбиение ячеек памяти на множества осуществляется таким образом, чтобы соседние ячейки относились
к разным множествам, что достигается размещением поля номера множества
не в старших, а в младших разрядах физического адреса.

Внутренняя кэш 80486 (рис. 5.4) имеет объем 8 Кбайт и предназначена для
хранения как команд, так и данных — копий информации ОЗУ. Информация
перемещается из ОЗУ в кэш выровненными 16-байтовыми блоками (4 младшие бита физического адреса — нули). Кэш имеет четырех направленную
(или четырехканальную) ассоциативную по множеству организацию, что является компромиссом между быстродействием и экономичностью кэш-памяти с прямым отображением и большим коэффициентом попаданий полностью ассоциативной кэш-памяти.

![[Pasted image 20240921120614.png]]

___

![[Снимок экрана 2024-09-21 120648.png]]

Обозначим строки в множестве как L0, LI, L2, L3. Каждому множеству
в блоке LRU соответствуют три бита В0, B1, B2, которые модифицируются
при каждом кэш-попадании или заполнении строки множества следующим
образом:

![[Pasted image 20240921120740.png]]

Цикл записи при наличии кэш-памяти может реализоваться по-разному. Различают кэш со ***сквозной записью и кэш с обратной записью.***

В первом случае в цикле записи не приводит к сокращению цикла записи даже при кэш-попадании, но гарантирует идентичность данных по адресам ОЗУ и КЭШ.

при обратной записи в случае кэш-попадания запись осуществляется только в кэш, при этом в соответствующей ячейке ОЗУ сохраняется прежнее (уже неверное) значение. Запись в ОЗУ происходит при очистке (замещении) строки кэш, если ее содержимое изменялось в процессе пребывания в кэш. 

Ситуация временного несоответствия содержимого ячеек кэш и ОЗУ может
быть допустима в одних случаях и недопустима в других (например, когда
несколько процессоров со своими кэш общаются через общее поле ОЗУ).
 Поэтому в большинстве случаев пользователю предоставляется возможность выбора способа записи в кэш — за счет модификации некоторых программно-доступных флагов в регистре управления.
 
 В 80486 строки кэш-памяти можно по отдельности объявить недостоверными, задавая операцию недостоверности кэш-памяти на шине процессора. При инициализации такой операции кэш сравнивает объявленный недостоверным адрес с тегом строк, находящихся в кэш, и сбрасывает бит достоверности при обнаружении соответствия тегов. Предусмотрена также операция очистки,  которая превращает в недостоверное все содержимое кэш. 

Конфигурацией кэш-памяти управляют два бита регистра CR0 состояния
машины: 

![[Pasted image 20240921121827.png]]
69